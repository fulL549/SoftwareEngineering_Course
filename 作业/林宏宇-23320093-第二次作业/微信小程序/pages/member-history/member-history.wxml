<view class="container">
  <!-- å¯¼èˆªæ  -->
  <navigation-bar 
    title="{{memberName}}çš„æ‰“å¡è®°å½•"
    back="{{true}}" 
    bindback="onBackTap"
  />
  
  <!-- å†…å®¹åŒºåŸŸ -->
  <scroll-view 
    class="content-scroll"
    scroll-y="{{true}}"
    enable-flex="{{true}}"
    refresher-enabled="{{true}}"
    refresher-triggered="{{loading}}"
    bindrefresherrefresh="onPullDownRefresh"
  >
    <!-- ç”¨æˆ·ä¿¡æ¯ -->
    <view class="user-info">
      <image class="user-avatar" src="{{memberInfo.avatarUrl || '/images/default-avatar.png'}}"></image>
      <view class="user-details">
        <view class="user-name">{{memberInfo.nickName}}</view>
        <view class="user-id">{{memberInfo.studentId || 'æœªè®¾ç½®å­¦å·'}}</view>
      </view>
      <view class="stats-box">
        <view class="stats-item">
          <view class="stats-value">{{totalCheckins || 0}}</view>
          <view class="stats-label">æ€»æ‰“å¡</view>
        </view>
        <view class="stats-item">
          <view class="stats-value">{{continuousCheckins || 0}}</view>
          <view class="stats-label">è¿ç»­æ‰“å¡</view>
        </view>
      </view>
    </view>
    
    <!-- æ‰“å¡è®°å½•ç­›é€‰ -->
    <view class="filter-bar">
      <view class="filter-item {{filterType === 'all' ? 'active' : ''}}" bindtap="onFilterTap" data-type="all">å…¨éƒ¨è®°å½•</view>
      <view class="filter-item {{filterType === 'month' ? 'active' : ''}}" bindtap="onFilterTap" data-type="month">æœ¬æœˆ</view>
      <view class="filter-item {{filterType === 'week' ? 'active' : ''}}" bindtap="onFilterTap" data-type="week">æœ¬å‘¨</view>
    </view>
    
    <!-- æ‰“å¡è®°å½•åˆ—è¡¨ -->
    <view class="history-list" wx:if="{{history.length > 0}}">
      <block wx:for="{{history}}" wx:key="_id">
        <view class="history-item">
          <view class="date-group">
            <view class="date-text">{{item.dateText}}</view>
            <view class="weekday">{{item.weekday}}</view>
          </view>
          <view class="checkin-details">
            <view class="time-box">
              <text class="checkin-time">{{item.timeText}}</text>
              <text class="task-name">{{item.taskTitle || item.taskName}}</text>
            </view>
            <view class="content-box" wx:if="{{item.content}}">
              <text class="content-label">å†…å®¹ï¼š</text>
              <text class="content-text">{{item.content}}</text>
            </view>
            <view class="content-box" wx:if="{{item.training}}">
              <text class="content-label">è®­ç»ƒï¼š</text>
              <text class="content-text">{{item.training}}</text>
            </view>
            <view class="content-box" wx:if="{{item.remark}}">
              <text class="content-label">å¤‡æ³¨ï¼š</text>
              <text class="content-text">{{item.remark}}</text>
            </view>
            <view class="location" wx:if="{{item.location}}">
              <text class="location-icon">ğŸ“</text>
              <text class="location-text">{{item.location}}</text>
            </view>
            <view class="images-box" wx:if="{{item.images && item.images.length > 0}}">
              <block wx:for="{{item.images}}" wx:for-item="image" wx:key="*this">
                <image 
                  class="checkin-image" 
                  src="{{image}}" 
                  mode="aspectFill"
                  bindtap="previewImage"
                  data-urls="{{item.images}}"
                  data-current="{{image}}"
                ></image>
              </block>
            </view>
          </view>
        </view>
      </block>
    </view>
    
    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-state" wx:if="{{!loading && history.length === 0}}">
      <text class="empty-text">æš‚æ— æ‰“å¡è®°å½•</text>
    </view>
    
    <!-- åŠ è½½çŠ¶æ€ -->
    <view class="loading-state" wx:if="{{loading && !isPullDownRefresh}}">
      <view class="loading-icon"></view>
      <text class="loading-text">åŠ è½½ä¸­...</text>
    </view>
  </scroll-view>
  
  <!-- åº•éƒ¨å®‰å…¨åŒºåŸŸ -->
  <view class="safe-area-bottom"></view>
</view> 